---

title: Chapter 7. Ensemble Learning & Random Forests
keywords: fastai
sidebar: home_sidebar


---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 07.Ensembles_RFs.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include image.html style="width: 50%;" file="static/imgs/Hard_voting.png" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">sklearn</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">VotingClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">log_clf</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">)</span>
<span class="n">rf_clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">svm_clf</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">gamma</span><span class="o">=</span><span class="s1">&#39;scale&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_moons</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.33</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">X_val</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_val</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((6700, 2), (6700,), (3300, 2), (3300,))</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">voting_clf</span> <span class="o">=</span> <span class="n">VotingClassifier</span><span class="p">(</span><span class="n">estimators</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;lr&#39;</span><span class="p">,</span> <span class="n">log_clf</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;rf&#39;</span><span class="p">,</span> <span class="n">rf_clf</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;svc&#39;</span><span class="p">,</span> <span class="n">svm_clf</span><span class="p">)],</span> <span class="n">voting</span><span class="o">=</span><span class="s1">&#39;hard&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">voting_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>VotingClassifier(estimators=[(&#39;lr&#39;,
                              LogisticRegression(C=1.0, class_weight=None,
                                                 dual=False, fit_intercept=True,
                                                 intercept_scaling=1,
                                                 l1_ratio=None, max_iter=100,
                                                 multi_class=&#39;warn&#39;,
                                                 n_jobs=None, penalty=&#39;l2&#39;,
                                                 random_state=None,
                                                 solver=&#39;lbfgs&#39;, tol=0.0001,
                                                 verbose=0, warm_start=False)),
                             (&#39;rf&#39;,
                              RandomForestClassifier(bootstrap=True,
                                                     class_weight=None,
                                                     criterion=&#39;gini&#39;...
                                                     n_jobs=None,
                                                     oob_score=False,
                                                     random_state=None,
                                                     verbose=0,
                                                     warm_start=False)),
                             (&#39;svc&#39;,
                              SVC(C=1.0, cache_size=200, class_weight=None,
                                  coef0=0.0, decision_function_shape=&#39;ovr&#39;,
                                  degree=3, gamma=&#39;scale&#39;, kernel=&#39;rbf&#39;,
                                  max_iter=-1, probability=False,
                                  random_state=None, shrinking=True, tol=0.001,
                                  verbose=False))],
                 flatten_transform=True, n_jobs=None, voting=&#39;hard&#39;,
                 weights=None)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Let's take a look at the performance of each classifier + ensemble method on the validation set:</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">clf</span> <span class="ow">in</span> <span class="p">[</span><span class="n">log_clf</span><span class="p">,</span> <span class="n">rf_clf</span><span class="p">,</span> <span class="n">svm_clf</span><span class="p">,</span> <span class="n">voting_clf</span><span class="p">]:</span>
    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_hat</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">clf</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>LogisticRegression 0.7996969696969697
RandomForestClassifier 0.786969696969697
SVC 0.8124242424242424
VotingClassifier 0.8106060606060606
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>There you have it! The voting classifier slightly outperforms the individual classifiers.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>If all ensemble method learners can estimate class probabilities, you can average their probabilities per class then predict the class with the highest probability.<ul>
<li>This is called <strong>Soft voting</strong>.</li>
<li>It often yields results better than hard voting because it weights confidence.</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include image.html style="width: 50%;" file="static/imgs/bagging.png" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Bagging-&amp;-Pasting-in-Scikit-Learn">Bagging &amp; Pasting in Scikit-Learn<a class="anchor-link" href="#Bagging-&amp;-Pasting-in-Scikit-Learn">&#182;</a></h3><ul>
<li>Let's implement bagging in scikit-learn:</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">BaggingClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bag_clf</span> <span class="o">=</span> <span class="n">BaggingClassifier</span><span class="p">(</span><span class="n">DecisionTreeClassifier</span><span class="p">(),</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bag_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>BaggingClassifier(base_estimator=DecisionTreeClassifier(class_weight=None,
                                                        criterion=&#39;gini&#39;,
                                                        max_depth=None,
                                                        max_features=None,
                                                        max_leaf_nodes=None,
                                                        min_impurity_decrease=0.0,
                                                        min_impurity_split=None,
                                                        min_samples_leaf=1,
                                                        min_samples_split=2,
                                                        min_weight_fraction_leaf=0.0,
                                                        presort=False,
                                                        random_state=None,
                                                        splitter=&#39;best&#39;),
                  bootstrap=True, bootstrap_features=False, max_features=1.0,
                  max_samples=100, n_estimators=500, n_jobs=-1, oob_score=False,
                  random_state=None, verbose=0, warm_start=False)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y_hat</span> <span class="o">=</span> <span class="n">bag_clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include image.html style="width:66%;" file="static/imgs/dt_bagging.png" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Out-of-Bag-Evaluation">Out-of-Bag Evaluation<a class="anchor-link" href="#Out-of-Bag-Evaluation">&#182;</a></h3><ul>
<li>With bagging, some instances will be sampled several times for several predictors, while others won't be sampled at all.</li>
<li>Only about 63% of the instances are sampled for each predictor.</li>
<li>The other 37% of instances not sampled are called Out-of-Bag (oob) instances. <ul>
<li>Note that they're not the same 37% for all predictors.</li>
</ul>
</li>
<li>Since the individual predictor never sees the oob samples, it can be evaluated on the oob data without the need for a separate validation set.</li>
<li>You can evaluate the ensemble itself by averaging the oob scores of each predictor.</li>
<li>Let's do this using scikit-learn:</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bag_clf</span> <span class="o">=</span> <span class="n">BaggingClassifier</span><span class="p">(</span><span class="n">DecisionTreeClassifier</span><span class="p">(),</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="mf">0.63</span><span class="p">,</span> <span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">oob_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bag_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>BaggingClassifier(base_estimator=DecisionTreeClassifier(class_weight=None,
                                                        criterion=&#39;gini&#39;,
                                                        max_depth=None,
                                                        max_features=None,
                                                        max_leaf_nodes=None,
                                                        min_impurity_decrease=0.0,
                                                        min_impurity_split=None,
                                                        min_samples_leaf=1,
                                                        min_samples_split=2,
                                                        min_weight_fraction_leaf=0.0,
                                                        presort=False,
                                                        random_state=None,
                                                        splitter=&#39;best&#39;),
                  bootstrap=True, bootstrap_features=False, max_features=1.0,
                  max_samples=0.63, n_estimators=500, n_jobs=-1, oob_score=True,
                  random_state=None, verbose=0, warm_start=False)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bag_clf</span><span class="o">.</span><span class="n">oob_score_</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.7986567164179105</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's verify this estimation using the validation set:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y_hat</span> <span class="o">=</span> <span class="n">bag_clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_hat</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.7972727272727272</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Close enough!</li>
<li>The oob decision function is also available using scikit-learn's API, since our classifier is a decision tree then the decision function is a ratio that can be expressed as a probability, let's take a look at it for each instance:</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bag_clf</span><span class="o">.</span><span class="n">oob_decision_function_</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[0.02352941, 0.97647059],
       [0.29411765, 0.70588235],
       [0.02016129, 0.97983871],
       ...,
       [1.        , 0.        ],
       [0.96212121, 0.03787879],
       [0.42084942, 0.57915058]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Random-Patches-&amp;-Random-Subspaces">Random Patches &amp; Random Subspaces<a class="anchor-link" href="#Random-Patches-&amp;-Random-Subspaces">&#182;</a></h2><ul>
<li>We can sample features as well.</li>
<li>Sampling is controlled by two hyper-parameters: <code>max_features</code> &amp; <code>bootstrap_features</code>.</li>
<li>Thus, each predictor will be trained on a random feature sample.</li>
<li>This technique is especially useful when you're dealing with high-dimensional input as as imagery. </li>
<li>Sample both instances and features is called the random patches method.</li>
<li>Sampling only features is called the random subspaces method.</li>
<li>Sampling features results in a more predictor diversity.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Random-Forests">Random Forests<a class="anchor-link" href="#Random-Forests">&#182;</a></h2><ul>
<li>A random forest is an ensemble of decision trees.</li>
<li>Let's use its scikit-learn implementation:</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rnd_clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">max_leaf_nodes</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rnd_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>RandomForestClassifier(bootstrap=True, class_weight=None, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=16,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, n_estimators=500,
                       n_jobs=-1, oob_score=False, random_state=None, verbose=0,
                       warm_start=False)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y_pred_rf</span> <span class="o">=</span> <span class="n">rnd_clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>The following <code>BaggingClassifier</code> is roughly equivalent to the previous <code>RandomForestClassifier</code>:</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bag_clf</span> <span class="o">=</span> <span class="n">BaggingClassifier</span><span class="p">(</span>
    <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">splitter</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="n">max_leaf_nodes</span><span class="o">=</span><span class="mi">16</span><span class="p">),</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">max_samples</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Extra-Trees">Extra-Trees<a class="anchor-link" href="#Extra-Trees">&#182;</a></h3><ul>
<li>When you are growing a tree in a random forest, only a subset of features are considered when splitting.</li>
<li>It's possible to make the trees more random by choosing different threshold of the features rather than searching for the best possible threshold.<ul>
<li>Such a model is called <strong>Extremely Randomized Trees Ensemble</strong>.</li>
</ul>
</li>
<li>We don't really know if an extremely randomized trees model will or will not outperform a classical random forest model.<ul>
<li>Generally, the only way to know is to try both and check their results using cross validation.</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Feature-Importance">Feature Importance<a class="anchor-link" href="#Feature-Importance">&#182;</a></h3><ul>
<li>Yet another great quality of random forests is that they make it so easy to measure the importance of each feature.</li>
<li>We measure the importance by averaging the reduced impurity of each node that uses a certain feature across all trees in the forest.<ul>
<li>More exactly it's a weighted average beacuse each node has a number of samples that is used to weight.</li>
</ul>
</li>
<li>Let's get feature importance using random forests on the iris dataset:</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_iris</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">iris</span> <span class="o">=</span> <span class="n">load_iris</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rnd_clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rnd_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="n">iris</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>RandomForestClassifier(bootstrap=True, class_weight=None, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, n_estimators=500,
                       n_jobs=-1, oob_score=False, random_state=None, verbose=0,
                       warm_start=False)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="s1">&#39;feature_names&#39;</span><span class="p">],</span> <span class="n">rnd_clf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>sepal length (cm) 0.09593054850777244
sepal width (cm) 0.02549556416926862
petal length (cm) 0.4267509724384687
petal width (cm) 0.45182291488449017
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Let's plot pixel-wise MNIST feature importance:</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_digits</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">digits</span> <span class="o">=</span> <span class="n">load_digits</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rnd_clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rnd_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">digits</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span> <span class="n">digits</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>RandomForestClassifier(bootstrap=True, class_weight=None, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, n_estimators=500,
                       n_jobs=-1, oob_score=False, random_state=None, verbose=0,
                       warm_start=False)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rnd_clf</span><span class="o">.</span><span class="n">feature_importances_</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Random Forest are very handy to get a quick understanding of what features actually matter, particularly if you need to perform feature selection.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Boosting">Boosting<a class="anchor-link" href="#Boosting">&#182;</a></h2><ul>
<li>Boosting refers to any ensemble method that can combine several weak learners into a strong learner.</li>
<li>The general idea of most boosting methods is to train predictors sequentially, each trying to correct its predecessor. </li>
<li>There are many boosting methods available, but by far the most popular one is <strong>AdaBoost</strong> (Adaptive boosting) and <strong>gradient boosting</strong>.</li>
<li>Let's start with Adaboost:</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include image.html style="width:50%;" file="static/imgs/adaboost.png" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">AdaBoostClassifier</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ada_clf</span> <span class="o">=</span> <span class="n">AdaBoostClassifier</span><span class="p">(</span><span class="n">base_estimator</span><span class="o">=</span><span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> 
                             <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="s1">&#39;SAMME.R&#39;</span><span class="p">,</span> 
                             <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ada_clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>AdaBoostClassifier(algorithm=&#39;SAMME.R&#39;,
                   base_estimator=DecisionTreeClassifier(class_weight=None,
                                                         criterion=&#39;gini&#39;,
                                                         max_depth=1,
                                                         max_features=None,
                                                         max_leaf_nodes=None,
                                                         min_impurity_decrease=0.0,
                                                         min_impurity_split=None,
                                                         min_samples_leaf=1,
                                                         min_samples_split=2,
                                                         min_weight_fraction_leaf=0.0,
                                                         presort=False,
                                                         random_state=None,
                                                         splitter=&#39;best&#39;),
                   learning_rate=0.5, n_estimators=200, random_state=None)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">ada_clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">),</span> <span class="n">y_val</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.8084848484848485</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gradient-Boosting">Gradient Boosting<a class="anchor-link" href="#Gradient-Boosting">&#182;</a></h3><ul>
<li>Just like Adaboost, Gradient Boosting works by sequentially adding predictors to an ensemble each one correcting its predecessor.</li>
<li>However, instead of tweaking the instance weights at every iteration like Adaboost does, this method tries to fit the new predictor to the <strong>residual errors</strong> made by the previous predictor.</li>
<li>Let's go through a simple regression example, First let's fit a decision tree regressor to a synthetically generated training set:</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span><span class="o">/</span><span class="mf">50.</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>  <span class="c1"># 1 feature</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree_reg1</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree_reg1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>DecisionTreeRegressor(criterion=&#39;mse&#39;, max_depth=2, max_features=None,
                      max_leaf_nodes=None, min_impurity_decrease=0.0,
                      min_impurity_split=None, min_samples_leaf=1,
                      min_samples_split=2, min_weight_fraction_leaf=0.0,
                      presort=False, random_state=None, splitter=&#39;best&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Next, we'll train a second decision tree regressor on the errors made by the first tree:</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y2</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">tree_reg1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree_reg2</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree_reg2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>DecisionTreeRegressor(criterion=&#39;mse&#39;, max_depth=2, max_features=None,
                      max_leaf_nodes=None, min_impurity_decrease=0.0,
                      min_impurity_split=None, min_samples_leaf=1,
                      min_samples_split=2, min_weight_fraction_leaf=0.0,
                      presort=False, random_state=None, splitter=&#39;best&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Now we train a third regressor on the errors made by the second regressor:</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y3</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">tree_reg2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree_reg3</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tree_reg3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>DecisionTreeRegressor(criterion=&#39;mse&#39;, max_depth=2, max_features=None,
                      max_leaf_nodes=None, min_impurity_decrease=0.0,
                      min_impurity_split=None, min_samples_leaf=1,
                      min_samples_split=2, min_weight_fraction_leaf=0.0,
                      presort=False, random_state=None, splitter=&#39;best&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Now we have an ensemble containing three trees. It can make predictions on a new instance simply by adding up the predictions of all the trees:</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="p">(</span><span class="n">tree_reg1</span><span class="p">,</span> <span class="n">tree_reg2</span><span class="p">,</span> <span class="n">tree_reg3</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include image.html style="width:66%;" file="static/imgs/boosting_ensembles.png" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingRegressor</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gbrt</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gbrt</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>GradientBoostingRegressor(alpha=0.9, criterion=&#39;friedman_mse&#39;, init=None,
                          learning_rate=1.0, loss=&#39;ls&#39;, max_depth=2,
                          max_features=None, max_leaf_nodes=None,
                          min_impurity_decrease=0.0, min_impurity_split=None,
                          min_samples_leaf=1, min_samples_split=2,
                          min_weight_fraction_leaf=0.0, n_estimators=3,
                          n_iter_no_change=None, presort=&#39;auto&#39;,
                          random_state=None, subsample=1.0, tol=0.0001,
                          validation_fraction=0.1, verbose=0, warm_start=False)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include image.html style="width:66%;" file="static/imgs/ensemble_overunderfit.png" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gbrt</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gbrt</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>GradientBoostingRegressor(alpha=0.9, criterion=&#39;friedman_mse&#39;, init=None,
                          learning_rate=0.1, loss=&#39;ls&#39;, max_depth=2,
                          max_features=None, max_leaf_nodes=None,
                          min_impurity_decrease=0.0, min_impurity_split=None,
                          min_samples_leaf=1, min_samples_split=2,
                          min_weight_fraction_leaf=0.0, n_estimators=120,
                          n_iter_no_change=None, presort=&#39;auto&#39;,
                          random_state=None, subsample=1.0, tol=0.0001,
                          validation_fraction=0.1, verbose=0, warm_start=False)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">errors</span> <span class="o">=</span> <span class="p">[</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span> <span class="k">for</span> <span class="n">y_pred</span> <span class="ow">in</span> <span class="n">gbrt</span><span class="o">.</span><span class="n">staged_predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bst_n_estimators</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">bst_n_estimators</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>74</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gbrt_best</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="n">bst_n_estimators</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gbrt_best</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>GradientBoostingRegressor(alpha=0.9, criterion=&#39;friedman_mse&#39;, init=None,
                          learning_rate=0.1, loss=&#39;ls&#39;, max_depth=2,
                          max_features=None, max_leaf_nodes=None,
                          min_impurity_decrease=0.0, min_impurity_split=None,
                          min_samples_leaf=1, min_samples_split=2,
                          min_weight_fraction_leaf=0.0, n_estimators=74,
                          n_iter_no_change=None, presort=&#39;auto&#39;,
                          random_state=None, subsample=1.0, tol=0.0001,
                          validation_fraction=0.1, verbose=0, warm_start=False)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include image.html style="width: 66%;" file="static/imgs/gradient_boosting_optimization.png" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gbrt</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">warm_start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">min_val_error</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>
<span class="n">error_going_up</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">n_estimators</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">120</span><span class="p">):</span>
    <span class="n">gbrt</span><span class="o">.</span><span class="n">n_estimators</span> <span class="o">=</span> <span class="n">n_estimators</span>
    <span class="n">gbrt</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">gbrt</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
    <span class="n">val_error</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">val_error</span> <span class="o">&lt;</span> <span class="n">min_val_error</span><span class="p">:</span>
        <span class="n">min_val_error</span> <span class="o">=</span> <span class="n">val_error</span>
        <span class="n">error_going_up</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">error_going_up</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">error_going_up</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">break</span>  <span class="c1"># Early Stopping</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>It's worth noting that an optimized implementation of gradient boosting is available in the popular python library <strong><code>XGBoost</code></strong> (Stands for Extreme Gradient Boosting).</li>
<li>Let's try it out:</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">xgboost</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgb_reg</span> <span class="o">=</span> <span class="n">xgboost</span><span class="o">.</span><span class="n">XGBRegressor</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgb_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[12:14:41] WARNING: src/objective/regression_obj.cu:152: reg:linear is now deprecated in favor of reg:squarederror.
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>XGBRegressor(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
             colsample_bynode=1, colsample_bytree=1, gamma=0,
             importance_type=&#39;gain&#39;, learning_rate=0.1, max_delta_step=0,
             max_depth=3, min_child_weight=1, missing=None, n_estimators=100,
             n_jobs=1, nthread=None, objective=&#39;reg:linear&#39;, random_state=0,
             reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
             silent=None, subsample=1, verbosity=1)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>The library can take care of early stopping for you:</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgb_reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">eval_set</span><span class="o">=</span><span class="p">[(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">)],</span> <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[12:14:41] WARNING: src/objective/regression_obj.cu:152: reg:linear is now deprecated in favor of reg:squarederror.
[0]	validation_0-rmse:0.386776
Will train until validation_0-rmse hasn&#39;t improved in 2 rounds.
[1]	validation_0-rmse:0.349144
[2]	validation_0-rmse:0.31514
[3]	validation_0-rmse:0.284409
[4]	validation_0-rmse:0.256772
[5]	validation_0-rmse:0.23159
[6]	validation_0-rmse:0.209239
[7]	validation_0-rmse:0.188911
[8]	validation_0-rmse:0.170811
[9]	validation_0-rmse:0.154397
[10]	validation_0-rmse:0.139691
[11]	validation_0-rmse:0.126491
[12]	validation_0-rmse:0.114665
[13]	validation_0-rmse:0.103941
[14]	validation_0-rmse:0.094375
[15]	validation_0-rmse:0.085778
[16]	validation_0-rmse:0.07798
[17]	validation_0-rmse:0.071142
[18]	validation_0-rmse:0.065024
[19]	validation_0-rmse:0.059581
[20]	validation_0-rmse:0.05463
[21]	validation_0-rmse:0.050262
[22]	validation_0-rmse:0.046396
[23]	validation_0-rmse:0.043042
[24]	validation_0-rmse:0.040033
[25]	validation_0-rmse:0.037395
[26]	validation_0-rmse:0.035047
[27]	validation_0-rmse:0.033029
[28]	validation_0-rmse:0.031416
[29]	validation_0-rmse:0.029887
[30]	validation_0-rmse:0.02858
[31]	validation_0-rmse:0.027483
[32]	validation_0-rmse:0.026584
[33]	validation_0-rmse:0.025829
[34]	validation_0-rmse:0.025172
[35]	validation_0-rmse:0.024614
[36]	validation_0-rmse:0.02416
[37]	validation_0-rmse:0.023827
[38]	validation_0-rmse:0.023487
[39]	validation_0-rmse:0.023175
[40]	validation_0-rmse:0.022949
[41]	validation_0-rmse:0.022766
[42]	validation_0-rmse:0.022623
[43]	validation_0-rmse:0.022492
[44]	validation_0-rmse:0.022385
[45]	validation_0-rmse:0.022307
[46]	validation_0-rmse:0.022225
[47]	validation_0-rmse:0.02216
[48]	validation_0-rmse:0.022104
[49]	validation_0-rmse:0.022054
[50]	validation_0-rmse:0.022013
[51]	validation_0-rmse:0.021979
[52]	validation_0-rmse:0.021945
[53]	validation_0-rmse:0.021928
[54]	validation_0-rmse:0.021908
[55]	validation_0-rmse:0.021899
[56]	validation_0-rmse:0.021891
[57]	validation_0-rmse:0.02189
[58]	validation_0-rmse:0.021876
[59]	validation_0-rmse:0.021867
[60]	validation_0-rmse:0.021846
[61]	validation_0-rmse:0.021857
[62]	validation_0-rmse:0.021863
Stopping. Best iteration:
[60]	validation_0-rmse:0.021846

</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>XGBRegressor(base_score=0.5, booster=&#39;gbtree&#39;, colsample_bylevel=1,
             colsample_bynode=1, colsample_bytree=1, gamma=0,
             importance_type=&#39;gain&#39;, learning_rate=0.1, max_delta_step=0,
             max_depth=3, min_child_weight=1, missing=None, n_estimators=100,
             n_jobs=1, nthread=None, objective=&#39;reg:linear&#39;, random_state=0,
             reg_alpha=0, reg_lambda=1, scale_pos_weight=1, seed=None,
             silent=None, subsample=1, verbosity=1)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">xgb_reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.0004772392356123875</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_val</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">y_val</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_val</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include image.html style="width: 50%;" file="static/imgs/blender.png" %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Exercices">Exercices<a class="anchor-link" href="#Exercices">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>1. If you have trained five different models on the exact same training data, and they all achieve 95% precision, is there any chance that you can combine these models to get better results? If so, How? If not, Why?</strong></p>
<ul>
<li>Yes, we can combine their predictions:<ul>
<li>Classification Problems<ul>
<li>hard voting (y_hat=mode(preds))</li>
<li>soft voting for classification (averaging estimated class probabilities and taking the class associated with the highest one).</li>
</ul>
</li>
<li>Regression Problems<ul>
<li>Taking the mean of the predicted values from each model.</li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>2. What is the difference between hard &amp; soft voting classifiers?</strong></p>
<ul>
<li>Hard voting: we take all of the predictions and output the mode (the most frequently predicted class).</li>
<li>Soft voting: we average all probabilities associated with each class and output the class with the highest averaged probability.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>3. Is it possible to speed up training of a bagging ensemble by distributing it across multiple servers? What about pasting ensembles? Boosting ensembles, random forests, stacking ensembles?</strong></p>
<ul>
<li>Bagging Ensemble (Bootstrap Aggregation  Sampling with replacement + feature subsetting): It is parallelizable.</li>
<li>Pasting Ensemble (Only difference  Sampling without replacement): It is parallelizable.</li>
<li>Boosting Ensemble (Trains predictors sequentially): Not parallelizable.</li>
<li>Random Forests: Parallelizable.</li>
<li>Stacking Ensemble: Stacking is partly parallelizable, we can train massive predictors in the first layer but we have to wait for the ith training phase to finish before training subsequent layers (and the final blender).</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>4. What is the benefit of out-of-bag evaluation?</strong></p>
<ul>
<li>We don't need a hold-out set and we evaluate each individual predictor on the fly and export and estimate of the overall performance of the ensemble model.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>5. What makes Extra-Trees more random than regular random forests? How can this extra randomness help? Are extra trees slower or faster than regular random forests?</strong></p>
<ul>
<li>Extra-Trees are more random than regular random forests in that they choose a subset of features to select from at each split and they don't necessary choose the best threshold but they take random thresholds.</li>
<li>This added randomness helps in creating much more varied trees and helps in training a good model.</li>
<li>Extra-trees are faster then regular random forests because they don't have to check for the best split on all features and thresholds.<ul>
<li>But extra-trees aren't faster then random forests in inference time.</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>6. If your Adaboost ensemble underfits the training data, which hyper-parameters should you tweak and how?</strong></p>
<ul>
<li>Increase the number of estimators and reducring the the regularization hyper-parameters for teh base estimator.</li>
<li>Increasing the learning rate.</li>
<li>We should decrease $\eta$ so that weights are not extreme.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>7. If your gradient boosting ensemble overfits the training set, should you increase or decrease the learning rate?</strong></p>
<ul>
<li>We should decrease the learning rate because it shrinks the contribution of each tree.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>8. Load MNIST data, and split it into a training set, a validation set, and a test set (Use 50k instances for training, 10k for validation, and 10k for testing)</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">fetch_openml</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;mnist_784&#39;</span><span class="p">,</span> <span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((70000, 784), (70000,))</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's shuffle and sample:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">random_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">random_indices</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">random_indices</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We verify that it's fine:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOcAAADnCAYAAADl9EEgAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4xLjEsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy8QZhcZAAAGrElEQVR4nO3dTYjNfR/HcXMneSgksZGnDUMiD81iJDsbJKUkCyslyUJjw8JGVmJhZ0VRHoaISKFkIVkQpaE8pCisyENiXIu7e3F3zfkelzHXfM7M67W8Pv3n/Bfe/ev69T+n7efPnyOAPP8Z7BsA+iZOCCVOCCVOCCVOCDWyye5/5cLAa+vrP3pyQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQihxQqiRg30Dg+HJkyflfvHixXLv7u4u97a2tnJ//vx5w23Lli3ltS9evCj3sWPHlvu6devKvaOjo+E2ZcqU8lr+LE9OCCVOCCVOCCVOCCVOCCVOCCVOCNX28+fPai/HVrV69epyv3z58r90J383Y8aMcv/27Vu5T506tdzv379f7qNHj264rVy5sry2q6ur3JcvX17uo0aNKvchrM+DcU9OCCVOCCVOCCVOCCVOCCVOCDUsj1Lmzp1b7j09PeU+adKkcp8+fXq5v3z5suE2ceLE8tpx48aV+/bt28t927Zt5T6Q2tvby/3WrVsNt8mTJ//p20niKAVaiTghlDghlDghlDghlDghlDgh1LD8asz58+eX+9OnT8t969at5X7gwIFyf/36dcNt/Pjx5bXv3r0r92nTppX7kiVLyn3jxo0Nt2fPnpXXNvP48eNyP3HiRMNt586d/frsVuTJCaHECaHECaHECaHECaHECaHECaGG5fucBw8eLPcfP36U++7du//k7USp/j2cP3++vHbDhg3l3tvbW+6dnZ0Nt9u3b5fXtjjvc0IrESeEEieEEieEEieEEieEEieEGpbvc+7atWuwbyFWdc754MGD3772V6xfv75f1w81npwQSpwQSpwQSpwQSpwQSpwQSpwQaliecw5njx49Kvc9e/Y03C5evNivz167dm25b9q0qV9/f6jx5IRQ4oRQ4oRQ4oRQ4oRQ4oRQjlJazMePH8v90KFD5b5v375y789rX3v37i336phmxIgRI0aPHv3bnz0UeXJCKHFCKHFCKHFCKHFCKHFCKHFCKOecg6C7u7vhdvr06fLaq1evlvuHDx9+657+Z/78+Q23/fv3l9c2eyWsra3PX7qjAU9OCCVOCCVOCCVOCCVOCCVOCCVOCNXW5P29/v2m2zB16dKlcl+zZs2/dCd/N2HChHJ/8+ZNw23MmDF/+nb4rz4PgD05IZQ4IZQ4IZQ4IZQ4IZQ4IZQ4IZT3OQfA58+fB/sWGmr2vbcdHR0Nt66urvLazZs3l7v3Of8ZT04IJU4IJU4IJU4IJU4IJU4IJU4I5X3OAfD+/ftyP3bsWMPtzJkz5bU9PT3l/vXr137t/XH37t1yX7Zs2YB9dovzPie0EnFCKHFCKHFCKHFCKHFCKEcpQ8zDhw/LvdnP+J06deq3P7u9vb3cz549W+7z5s377c9ucY5SoJWIE0KJE0KJE0KJE0KJE0KJE0L5aswhZsGCBeV+/Pjxcl+8eHHD7fDhw+W1jx8/Lvdr166V+zA+5+yTJyeEEieEEieEEieEEieEEieEEieE8j4nv2zHjh3lfuTIkXLv7Ows9+oMdvbs2eW1Lc77nNBKxAmhxAmhxAmhxAmhxAmhxAmhvM/JL1u4cGG/rr9371659/b29uvvDzWenBBKnBBKnBBKnBBKnBBKnBDKUcow8+TJk3KvXttq9tWYzcyaNavcJ02a1K+/P9R4ckIocUIocUIocUIocUIocUIocUKoYXnO+f3793K/c+dOuc+ZM6fcb9y4Ue6vXr1quDX5qtIRFy5cKPdPnz6Ve09PT7l/+fKl3CurVq0q96NHj5a7c87/58kJocQJocQJocQJocQJocQJocQJoYblTwC+ffu23BctWlTuzc5J371794/vqRWMHFkfi1+/fr3cV6xY8SdvZyjxE4DQSsQJocQJocQJocQJocQJocQJoYblOWczV65cKfeTJ0+We0dHR7mfO3eu4Xbz5s3y2mbGjRtX7mvXri33mTNnNtzWr19fXrt06dJypyHnnNBKxAmhxAmhxAmhxAmhxAmhxAmhnHPC4HPOCa1EnBBKnBBKnBBKnBBKnBBKnBBKnBBKnBBKnBBKnBBKnBBKnBBKnBBKnBBKnBBKnBBKnBBKnBBKnBBKnBBKnBBqZJO9z6/sAwaeJyeEEieEEieEEieEEieEEieE+gtariCLXfFeggAAAABJRU5ErkJggg==
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;3&#39;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's split it:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="mi">50000</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="mi">50000</span><span class="p">]</span>
<span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">50000</span><span class="p">:</span><span class="mi">60000</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">50000</span><span class="p">:</span><span class="mi">60000</span><span class="p">]</span>
<span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">60000</span><span class="p">:],</span> <span class="n">y</span><span class="p">[</span><span class="mi">60000</span><span class="p">:]</span>
<span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">X_val</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_val</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((50000, 784), (50000,), (10000, 784), (10000,), (10000, 784), (10000,))</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I don't have enough compute power, let's take 10% of each dataset:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[:</span><span class="mi">5000</span><span class="p">],</span> <span class="n">y_train</span><span class="p">[:</span><span class="mi">5000</span><span class="p">]</span>
<span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">X_val</span><span class="p">[:</span><span class="mi">1000</span><span class="p">],</span> <span class="n">y_val</span><span class="p">[:</span><span class="mi">1000</span><span class="p">]</span>
<span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[:</span><span class="mi">1000</span><span class="p">],</span> <span class="n">y_test</span><span class="p">[:</span><span class="mi">1000</span><span class="p">]</span>
<span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">X_val</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_val</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((5000, 784), (5000,), (1000, 784), (1000,), (1000, 784), (1000,))</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Train a Random Forests Classifier, an Extra-Trees classifier, &amp; an SVM classifier</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span><span class="p">,</span> <span class="n">ExtraTreesClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span> <span class="k">as</span> <span class="n">acc</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">etc</span> <span class="o">=</span> <span class="n">ExtraTreesClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">svc</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>RandomForestClassifier(bootstrap=True, class_weight=None, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, n_estimators=10,
                       n_jobs=None, oob_score=False, random_state=None,
                       verbose=0, warm_start=False)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">etc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>ExtraTreesClassifier(bootstrap=False, class_weight=None, criterion=&#39;gini&#39;,
                     max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                     min_impurity_decrease=0.0, min_impurity_split=None,
                     min_samples_leaf=1, min_samples_split=2,
                     min_weight_fraction_leaf=0.0, n_estimators=10, n_jobs=None,
                     oob_score=False, random_state=None, verbose=0,
                     warm_start=False)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">svc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/mohamedakramzaytar/opt/miniconda3/envs/research/lib/python3.7/site-packages/sklearn/svm/base.py:193: FutureWarning: The default value of gamma will change from &#39;auto&#39; to &#39;scale&#39; in version 0.22 to account better for unscaled features. Set gamma explicitly to &#39;auto&#39; or &#39;scale&#39; to avoid this warning.
  &#34;avoid this warning.&#34;, FutureWarning)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SVC(C=1.0, cache_size=200, class_weight=None, coef0=0.0,
    decision_function_shape=&#39;ovr&#39;, degree=3, gamma=&#39;auto_deprecated&#39;,
    kernel=&#39;rbf&#39;, max_iter=-1, probability=True, random_state=None,
    shrinking=True, tol=0.001, verbose=False)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">acc</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">rfc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)),</span> <span class="n">acc</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)),</span> <span class="n">acc</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(0.892, 0.882, 0.096)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Try to combine them into an ensemble that outperforms each individual classifier on the validation set, using soft or hard voting</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">VotingClassifier</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hard_voter</span> <span class="o">=</span> <span class="n">VotingClassifier</span><span class="p">(</span><span class="n">estimators</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;random forest&#39;</span><span class="p">,</span> <span class="n">rfc</span><span class="p">),</span> 
                                          <span class="p">(</span><span class="s1">&#39;extra trees&#39;</span><span class="p">,</span> <span class="n">etc</span><span class="p">),</span> 
                                          <span class="p">(</span><span class="s1">&#39;support vector classifier&#39;</span><span class="p">,</span> <span class="n">svc</span><span class="p">)],</span> 
                              <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hard_voter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>VotingClassifier(estimators=[(&#39;random forest&#39;,
                              RandomForestClassifier(bootstrap=True,
                                                     class_weight=None,
                                                     criterion=&#39;gini&#39;,
                                                     max_depth=None,
                                                     max_features=&#39;auto&#39;,
                                                     max_leaf_nodes=None,
                                                     min_impurity_decrease=0.0,
                                                     min_impurity_split=None,
                                                     min_samples_leaf=1,
                                                     min_samples_split=2,
                                                     min_weight_fraction_leaf=0.0,
                                                     n_estimators=10,
                                                     n_jobs=None,
                                                     oob_score=False,
                                                     random_state=No...
                                                   random_state=None, verbose=0,
                                                   warm_start=False)),
                             (&#39;support vector classifier&#39;,
                              SVC(C=1.0, cache_size=200, class_weight=None,
                                  coef0=0.0, decision_function_shape=&#39;ovr&#39;,
                                  degree=3, gamma=&#39;auto_deprecated&#39;,
                                  kernel=&#39;rbf&#39;, max_iter=-1, probability=True,
                                  random_state=None, shrinking=True, tol=0.001,
                                  verbose=False))],
                 flatten_transform=True, n_jobs=-1, voting=&#39;hard&#39;,
                 weights=None)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">soft_voter</span> <span class="o">=</span> <span class="n">VotingClassifier</span><span class="p">(</span><span class="n">estimators</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;random forest&#39;</span><span class="p">,</span> <span class="n">rfc</span><span class="p">),</span> 
                                          <span class="p">(</span><span class="s1">&#39;extra trees&#39;</span><span class="p">,</span> <span class="n">etc</span><span class="p">),</span> 
                                          <span class="p">(</span><span class="s1">&#39;support vector classifier&#39;</span><span class="p">,</span> <span class="n">svc</span><span class="p">)],</span>
                              <span class="n">voting</span><span class="o">=</span><span class="s1">&#39;soft&#39;</span><span class="p">,</span>
                              <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">soft_voter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>VotingClassifier(estimators=[(&#39;random forest&#39;,
                              RandomForestClassifier(bootstrap=True,
                                                     class_weight=None,
                                                     criterion=&#39;gini&#39;,
                                                     max_depth=None,
                                                     max_features=&#39;auto&#39;,
                                                     max_leaf_nodes=None,
                                                     min_impurity_decrease=0.0,
                                                     min_impurity_split=None,
                                                     min_samples_leaf=1,
                                                     min_samples_split=2,
                                                     min_weight_fraction_leaf=0.0,
                                                     n_estimators=10,
                                                     n_jobs=None,
                                                     oob_score=False,
                                                     random_state=No...
                                                   random_state=None, verbose=0,
                                                   warm_start=False)),
                             (&#39;support vector classifier&#39;,
                              SVC(C=1.0, cache_size=200, class_weight=None,
                                  coef0=0.0, decision_function_shape=&#39;ovr&#39;,
                                  degree=3, gamma=&#39;auto_deprecated&#39;,
                                  kernel=&#39;rbf&#39;, max_iter=-1, probability=True,
                                  random_state=None, shrinking=True, tol=0.001,
                                  verbose=False))],
                 flatten_transform=True, n_jobs=-1, voting=&#39;soft&#39;,
                 weights=None)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">acc</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">hard_voter</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.875</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">acc</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">soft_voter</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.919</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Once you have found one, try it on the test set. How much better does it perform compared to the individual classifiers?</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">acc</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">rfc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)),</span> <span class="n">acc</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)),</span> <span class="n">acc</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(0.88, 0.882, 0.103)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">acc</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">hard_voter</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.864</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">acc</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">soft_voter</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.909</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>9. Run the previous classifiers from the previous exercice to make predictions on the validation set, and create a new training set with the resulting predictions</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">etc_preds</span> <span class="o">=</span> <span class="n">etc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">rfc_preds</span> <span class="o">=</span> <span class="n">rfc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">svc_preds</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">etc_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">rfc_preds</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">svc_preds</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((1000, 1), (1000, 1), (1000, 1))</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Each training instance is a vector containing the set of predictions from all your classifiers for an image, and the target is the class image. Train a classifier on this new training set</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_val_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">etc_preds</span><span class="p">,</span> <span class="n">rfc_preds</span><span class="p">,</span> <span class="n">etc_preds</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_val_</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(1000, 3)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rfc_</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rfc_</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_val_</span><span class="p">,</span> <span class="n">y_val</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>RandomForestClassifier(bootstrap=True, class_weight=None, criterion=&#39;gini&#39;,
                       max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
                       min_impurity_decrease=0.0, min_impurity_split=None,
                       min_samples_leaf=1, min_samples_split=2,
                       min_weight_fraction_leaf=0.0, n_estimators=10,
                       n_jobs=None, oob_score=False, random_state=None,
                       verbose=0, warm_start=False)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Congratulations, you have just trained a blender, and together with the classifiers it forms a stacking ensemble!</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Now evaluate the ensemble on the test set.</strong></p>
<ol>
<li>For each image in the test set, make predictions with all your classifiers</li>
<li>feed the predictions to the blender to get the ensembles predictions.</li>
<li>How does it compare to the voting classifier you trained earlier?</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">etc_preds</span> <span class="o">=</span> <span class="n">etc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">rfc_preds</span> <span class="o">=</span> <span class="n">rfc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">svc_preds</span> <span class="o">=</span> <span class="n">svc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_test_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">etc_preds</span><span class="p">,</span> <span class="n">rfc_preds</span><span class="p">,</span> <span class="n">etc_preds</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y_test_</span> <span class="o">=</span> <span class="n">rfc_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">acc</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.887</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It does better than the hard voter and worse then the softvoter.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
</div>
 

